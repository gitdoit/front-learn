# `Webpack` 优化

### 1、`HMR`-热模块加载

> 使用`webpack-dev-server`开启开发服务的时候，如果修改了某个`css`文件或者是某个`js`文件就会导致整个模块被重新加载，这样在项目非常大的时候会很慢，我们只需要对修改了的服务进行重新编译加载就行了

1. 修改`webpack.config.js`

   ```javascript
   // 在开发服务器选项中开启 `HMR`,设置`hot:true`
   module.exports = {
     devServer: {
       // ...
       hot: true
     }
   }
   ```

2. 解决修改`html`不更新的问题

   > 开启了`HRM`之后，修改`index.html`就不会更新了，需要将入口处添加`index.html`

   ```javascript
   module.exports = {
     // ...
     entry: ['./src/index.js', './src/index.html'],
   }
   ```

3. 解决修改单个`js`文件全局刷新的问题

   ```javascript
   // index.js
   if (module.hot) {
     // 一旦 module.hot 为true，说明开启了HMR功能。 --> 让HMR功能代码生效
     module.hot.accept('./js/module', () => {
       // 方法会监听 print.js 文件的变化，一旦发生变化，其他模块不会重新打包构建。
       // 会执行后面的回调函数
       fun();
     });
   }
   ```

   

### 2、`source-map`快速定位异常

> `source-map`就是用来映射原代码和编译后代码关系的技术，方便我们在开发或生产环境快速定位异常。
>
> 总结：
>
> ​	开发环境使用： `eval-source-map`
>
> ​	生产环境使用：`source-map`

1. 配置

   ```javascript
   module.exports = {
     devtool: 'eval-source-map'
   }
   ```

   

2. 选择组合

```
source-map: 一种 提供源代码到构建后代码映射 技术 （如果构建后代码出错了，通过映射可以追踪源代码错误）

    [inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map

    source-map：外部
      错误代码准确信息 和 源代码的错误位置
    inline-source-map：内联
      只生成一个内联source-map
      错误代码准确信息 和 源代码的错误位置
    hidden-source-map：外部
      错误代码错误原因，但是没有错误位置
      不能追踪源代码错误，只能提示到构建后代码的错误位置
    eval-source-map：内联
      每一个文件都生成对应的source-map，都在eval
      错误代码准确信息 和 源代码的错误位置
    nosources-source-map：外部
      错误代码准确信息, 但是没有任何源代码信息
    cheap-source-map：外部
      错误代码准确信息 和 源代码的错误位置 
      只能精确的行
    cheap-module-source-map：外部
      错误代码准确信息 和 源代码的错误位置 
      module会将loader的source map加入

    内联 和 外部的区别：1. 外部生成了文件，内联没有 2. 内联构建速度更快

    开发环境：速度快，调试更友好
      速度快(eval>inline>cheap>...)
        eval-cheap-souce-map
        eval-source-map
      调试更友好  
        souce-map
        cheap-module-souce-map
        cheap-souce-map

      --> eval-source-map  / eval-cheap-module-souce-map

    生产环境：源代码要不要隐藏? 调试要不要更友好
      内联会让代码体积变大，所以在生产环境不用内联
      nosources-source-map 全部隐藏
      hidden-source-map 只隐藏源代码，会提示构建后代码错误信息

      --> source-map / cheap-module-souce-map
```

